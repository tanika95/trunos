\documentclass{mais}
\usepackage{mathtext}
\usepackage[T2A]{fontenc}
\usepackage[cp1251]{inputenc}
\usepackage[english,russian]{babel}
\usepackage[mag=1000,a4paper,left=2.2cm,right=3.0cm,top=3.1cm,bottom=3.0cm]{geometry}
\usepackage{graphicx}
\usepackage{amsfonts,amssymb,amscd,amsmath,amsthm}
\usepackage{mathrsfs}
\usepackage{epsf}
\usepackage{wrapfig}
\usepackage{cite}
\usepackage[hyper]{amsbib}
\usepackage[lang=english]{bicaption}

%% поля, заполняемые редакцией
\date{15 марта}\ydate{2017}%дата получения
\firstpage{5}%начальная страница статьи

%% поля, заполняемые автором
\title{Построение бортовых сетей реального времени на основе технологии ПКС ${}^{1}$}
\titlecr{Построение бортовых сетей реального времени на основе технологии ПКС}
\author{Балашов~В.В., Костенко В.А., Ермакова Т. И.}%Фамилия И.О. автора, номер ссылки на финансовую поддержку в пункте Благодарности
\authorcr{Балашов~В.В., Костенко В.А., Ермакова Т. И.} %Фамилия И.О. автора для строки с авторским знаком
%ссылки на финансовую поддержку на русском и английском языках (по желанию автора):
\support{$^{1}$ Работа выполнена при поддержке РФФИ (проект № 17-07-01566).}

\supporten{$^{1}$ This work is partially supported by the Russian Foundation for Basic Research under grant № 17-07-01566.}


\UDC{517.9} %Номер УДК
\DOI{10.18255/1818-1015-} % заполняется редакцией
\shorttitle{Построение бортовых сетей реального времени на основе технологии ПКС}
\entitle{Design of Onboard Real-Time Networks Based on SDN Technology}%Название статьи на английском языке. Каждое значимое слово пишется с большой буквы
%Фамилия И.О. автора на английском языке:
\enauthorcr{Vasily V. Balashov, Valery A. Kostenko, Tatiana I. Ermakova}

%информация об авторах на русском языке: ФИО полностью, код orcid.org (следует получить, зарегистрировавшись на сайте http://orcid.org), ученая степень, ученое звание, официальное название места работы в именительном падеже, официальный почтовый адрес, e-mail:
\authorinform{
\\ Балашов Василий Викторович, orcid.org/0000-0001-5211-805X,
\\ Московский государственный университет имени М.В. Ломоносова,
Факультет вычислительной математики и кибернетики,
\\ Москва, Россия, e-mail: hbd@cs.msu.su
\vspace{4pt}
\\ Костенко Валерий Алексеевич, orcid.org/0000-0002-7895-2322,
\\ Московский государственный университет имени М.В. Ломоносова,
Факультет вычислительной математики и кибернетики,
\\ Москва, Россия, e-mail: kostmsu@gmail.com
\vspace{4pt}
\\ Ермакова Татьяна Ивановна, orcid.org/0000-0003-0224-9136,
\\ Московский государственный университет имени М.В. Ломоносова,
Факультет вычислительной математики и кибернетики,
\\ Москва, Россия, e-mail: tanyaerm@mail.ru
\vskip 6pt
\noindent{\bfБлагодарности:}\\ \maissupportval
}
%информация об авторах на английском языке: ФИО полностью, код orcid.org (следует получить, зарегистрировавшись на сайте http://orcid.org), ученая степень, ученое звание, официальное название места работы в именительном падеже, официальный почтовый адрес, e-mail
\authorinformen{
\\ Vasily V. Balashov, orcid.org/0000-0001-5211-805X,
\\ Department of Computational Mathematics and Cybernetics, Lomonosov Moscow State University
\\ Moscow, Russia, e-mail: hbd@cs.msu.su
\vspace{4pt}
\\ Valery A. Kostenko, orcid.org/0000-0002-7895-2322,
\\ Department of Computational Mathematics and Cybernetics, Lomonosov Moscow State University
\\ Moscow, Russia, e-mail: kostmsu@gmail.com
\vspace{4pt}
\\ Tatiana I. Ermakova, orcid.org/0000-0003-0224-9136,
\\ Department of Computational Mathematics and Cybernetics, Lomonosov Moscow State University
\\ Moscow, Russia, e-mail: tanyaerm@mail.ru
\vskip 4pt
\noindent{{\bf Acknowledgments:}\\ \maissupportvalen}
}
\keywords{программно-конфигурируемые сети, системы реального времени, бортовые системы}
\enkeywords{software defined networks, real-time, onboard computer systems}

\enabstract{Modern onboard equipment complexes (OEC) utilize AFDX and FC-AE-ASM-RT switched networks implementing a virtual link-based approach to real-time data transfer. Main drawback of these networks is their limited or absent support for dynamic reconfiguration of virtual links, leading to impossibility to dynamically compose OEC operation modes, particularly in case of multiple equipment failures. To remove these drawbacks, in this paper an approach is proposed to use of software-defined networks (SDN) as onboard real-time networks. The proposed approach is based on implementation of a virtual link-based technology (similar to those used in AFDX and FC-AE-ASM-RT) in an SDN supporting OpenFlow 1.3 protocol. The approach was implemented as a functional prototype and experimentally evaluated in a virtual network environment based on Ofsoftswitch13 software SDN switches and RUNOS controller. The experiments indicated that the proposed data exchange scheme allows transfer of messages within the given limits on delay and jitter, and does not allow violation of constraints on virtual link bandwidth. The experiments also confirmed that dynamic reconfiguration of virtual links in SDN does not interrupt data transfer through unchanged virtual links. An important direction for future work is development of algorithms for dynamic creation of virtual link routes in course of OEC reconfiguration. Final goal of the research is to create an SDN-based network technology supporting both real-time data transfer and automatic network reconfiguration in case of OEC mode change, in particular to parry multiple failures.
}%Аннотация на английском языке, соответствующая аннотации на русском языке, объем не менее 180--200 слов (необходимое требование для международных баз данных)


%%%%Макросы необходимые автору
\def\W{\overset{\circ}{W}}
\newcommand{\ve}{\varepsilon}
\newcommand{\eps}{\varepsilon}

\renewcommand{\Re}{\operatorname{Re}}
\renewcommand{\Im}{\operatorname{Im}}

\newtheorem{theor}{Теорема}
\newtheorem{lemma}{Лемма}
\newtheorem{dfn}{Определение}
%%%%%Макросы необходимые автору

\begin{document}
\maketitle
%\begin{abstract} Размер аннотации не менее 180--200 слов
\footnotesize В интегрированных модульных комплексах бортового оборудования (КБО) используются коммутируемые сети AFDX и FC-AE-ASM-RT, реализующие основанный на виртуальных каналах подход к передаче данных в реальном времени. Основным недостатком этих сетей являются ограниченные или отсутствующие возможности динамической реконфигурации виртуальных каналов, что приводит к невозможности динамического формирования режимов функционирования КБО, в частности при множественных отказах оборудования. Для снятия выявленных ограничений в данной работе предложен подход к использованию программно-конфигурируемых сетей (ПКС) для построения бортовых сетей реального времени. Предложенный подход основан на реализации в сети ПКС, поддерживающей протокол OpenFlow1.3, механизма виртуальных каналов, аналогичного используемому в сетях AFDX и FC-AE-ASM-RT. Подход реализован в виде функционального прототипа и экспериментально апробирован в виртуальной сетевой среде, основанной на программных ПКС-коммутаторах Ofsoftswitch13 и сетевом контроллере RUNOS. Эксперименты показали, что предложенная схема передачи данных позволяет передавать сообщения с соблюдением заданных ограничений на задержку и джиттер, а также не допускает превышения ограничения на пропускную способность виртуального канала. Эксперименты также подтвердили, что динамическая реконфигурация виртуальных каналов в ПКС не нарушает передачу данных по не изменяемым виртуальным каналам. Важным направлением дальнейших исследований является разработка алгоритмов динамического формирования новых маршрутов виртуальных каналов в процессе реконфигурации КБО. Конечной целью работ является создание на основе ПКС сетевой технологии, обеспечивающей как передачу данных в реальном времени, так и автоматическое переконфигурирование сети при смене режимов функционирования КБО, в том числе при парировании множественных отказов.
%\end{abstract}

\makeinfo

\normalsize

\section*{Введение}\label{s1}

В современных комплексах бортового оборудования (КБО) авиационного, морского и космического назначения широко используются два вида архитектур --- федеративная и интегрированная модульная \cite{1}. В соответствии с интегрированной модульной архитектурой (ИМА), КБО состоит из набора стандартных вычислительных модулей, соединенных коммутируемой сетью обмена данными с поддержкой виртуальных каналов. Такая сеть может быть построена на основе одного из следующих стандартов:

\begin{itemize}
\item ARINC 664 (AFDX) \cite{2}, основанный на Ethernet;
\item профиль Fibre Channel реального времени (FC-AE-ASM-RT) \cite{3, 4}.
\end{itemize}

Аппаратные ресурсы вычислительных модулей в интегрированном модульном КБО разделяются между различными прикладными программами (подсистемами), каждая из которых содержит в себе ряд прикладных задач.

В данной работе приведен обзор возможностей сетей AFDX и FC-AE-ASM-RT по передаче данных в реальном времени и выделены присущие им ограничения; предложен подход к организации передачи данных в реальном времени в коммутируемых сетях ПКС с использованием элементов протокола AFDX. Данный подход апробирован в виртуальной сетевой среде, использующей сетевой контроллер RUNOS \cite{5}.

Использование ПКС для передачи данных в реальном времени в бортовых сетях позволит избавиться от ограничений существующих сетей AFDX и FC-AE-ASM-RT, в значительной мере сужающих возможности реализации динамических режимов функционирования КБО, включая реконфигурацию в случае множественных отказов. 

\section{Требования к передаче данных в реальном времени в бортовых сетях}

На этапе проектирования КБО определяются режимы работы комплекса. Для каждого режима определяется набор прикладных задач, которые должны в нем выполняться, и набор сообщений, которые должны быть переданы между задачами и/или бортовыми датчиками и исполнительными устройствами. При смене режима работы КБО, набор прикладных задач и сообщений также меняется.

Для каждого сообщения задаются:
\begin{enumerate}
\item требования к передаче в реальном времени;
\item размер;
\item максимальный джиттер (флуктуация задержки) порождения сообщения внутри директивного интервала;
\item абонент-отправитель сообщения;
\item один или несколько абонентов-получателей сообщения.
\end{enumerate}

В интегрированном модульном КБО сетевыми абонентами могут являться вычислительные модули или унаследованные устройства с федеративной архитектурой.
Требования к передаче сообщений в реальном времени задаются, как правило, путем назначения сообщению частоты передачи F (или периода $1/F$) и фазовых сдвигов ($\phi1$, $\phi2$). Частота передачи сообщения определяет набор временных интервалов, длины которых равны периоду сообщения. При помощи фазовых сдвигов для каждого такого интервала определяется подынтервал ($s_{i}$, $f_{i}$), в рамках которого должно быть передано сообщение, называемый директивным интервалом (см.~Рис.~\ref{fig1}).

\begin{figure}[ht]
\centering
\includegraphics[width=0.50\textwidth]{fig1.png}
\bicaption[russian]{Требования к передаче сообщения в реальном времени.}[english]{Requirements to real-time transfer of messages.}
\label{fig1}
\end{figure}

Периодические сообщения, описанные выше, определяют поток данных через сеть.

При передаче сообщений должны выполняться следующие ограничения:
\begin{enumerate}
\item Сообщение должно быть передано ровно один раз в период, в рамках директивного интервала. Если сообщение порождается чаше одного раза в период, то повторные экземпляры сообщения должны сбрасываться.
\item Максимальная длительность передачи сообщения с момента выдачи сообщения абонентом-отправителем до момента получения сообщения всеми абонентами-получателями не должна превышать заданного значения. Сообщение считается принятым, когда получен его последний кадр.
\item Максимальный джиттер передачи сообщения (разность между максимальной и минимальной длительностью передачи сообщения) не должен превышать заданного значения.
\end{enumerate}

\section{Передача данных в реальном времени через коммутируемые сети с виртуальными каналами}

Используемые в интегрированных модульных КБО сети AFDX и FC-AE-ASM-RT имеют много общего в части организации передачи данных в реальном времени. В частности, в обоих видах сетей используется механизм виртуальных каналов для разделения пропускной способности и контроля трафика.
В данном разделе подробно описана схема передачи данных в сетях AFDX, а также приведены основные особенности передачи данных в сетях FC-AE-ASM-RT.

Сеть AFDX состоит из следующих элементов (Рис.~\ref{fig2}):
\begin{itemize}
\item бортовые системы (абоненты), которые порождают и принимают сообщения;
\item оконечные системы, которые предоставляют интерфейс между абонентами и сетью;
\item пакетные коммутаторы;
\item линии передачи данных.
\end{itemize}

\begin{figure}[ht]
	\centering
	\includegraphics[width=0.50\textwidth]{fig2.png}
	\bicaption[russian]{Типовая структура сети AFDX.}[english]{Typical structure of an AFDX network.}
	\label{fig2}
\end{figure}

В данной работе не рассматривается детально принятое в AFDX разделение на абонентов и оконечные системы. Далее будем считать, что сеть состоит из узлов (принимающих и отправляющих сообщения), коммутаторов и линий передачи данных.

Сети AFDX используют стек протоколов, основанный на семействе протоколов TCP/IP. На канальном уровне используется модифицированный протокол Ethernet с маршрутизацией на основе виртуальных каналов (вместо маршрутизации на основе MAC-адресов). На сетевом уровне используется протокол IP, однако маршрутизация на этом уровне не производится, так как функция маршрутизации перекладывается на канальный уровень. На транспортном уровне используется протокол UDP.

Обмен данными между узлами осуществляется путем передачи сообщений по виртуальным каналам, маршруты которых задаются заранее. Для каждого виртуального канала определен один узел-отправитель и один или более узел-получатель. Использование виртуальных каналов в сети AFDX обеспечивает разделение пропускной способности между различными потоками данных и соблюдение ограничений на время передачи сообщений через сеть.

Узел-отправитель разбивает сообщение на кадры, не превышающие определенного максимального размера, которые в свою очередь выдаются в физическую линию передачи данных. Номер виртуального канала записывается в поле MAC адреса каждого кадра. После доставки кадра узлу-получателю, он буферизуется для последующей сборки сообщения. После прихода последнего кадра собранное сообщение направляется задачам, выполняемым на узле.

Надежность передачи данных в сетях AFDX обеспечивают за счет резервирования сетевого оборудования. Каждый узел соединен с двумя независимыми сетями AFDX, имеющими одинаковую структуру. Каждый кадр выдается в обе сети и следует в них по одинаковым маршрутам. На узле-получателе происходит проверка целостности кадров, и если в одной из сетей диагностируется ошибка передачи кадра (например, не совпадает контрольная сумма), то кадр берется из той сети, где не было ошибки. Если корректный кадр приходит из обеих сетей, используется тот кадр, который пришел раньше.

Таблицы маршрутизации AFDX-коммутаторов (содержащие информацию о виртуальных каналах) настраиваются заранее, до начала функционирования КБО. Помимо маршрутизации кадров, AFDX-коммутаторы выполняют контроль и фильтрацию трафика. В процессе фильтрации трафика для каждого виртуального канала проверяются целостность и порядок следования кадров. Контроль трафика обеспечивает виртуальному каналу требуемую пропускную способность и предотвращает ее превышение. Контроль пропускной способности виртуальных каналов в AFDX осуществляется при помощи алгоритма текущего ведра, в котором виртуальному каналу сопоставляется счетчик кредита. Если кредита недостаточно для поступившего на коммутатор кадра виртуального канала, коммутатор сбрасывает кадр. Скорость восстановления кредита определяется пропускной способностью виртуального канала.

Пропускная способность и маршрут виртуального канала устанавливаются заранее, до начала функционирования КБО. Таким образом, маршрутизация в сети AFDX задается статически, возможность динамически (во время функционирования КБО) изменять таблицы маршрутизации стандартом не предусмотрена.

Основное отличие сетей FC-AE-ASM-RT от сетей AFDX в части контроля трафика заключается в том, что контроль осуществляется на уровне сообщений, а не отдельных кадров. Также не используется разреженная передача кадров каждого виртуального канала с интервалом, определяемым значением $BAG_{vl}$ (введено ниже); кадры сообщения выдаются в физическую линию последовательно, без пауз.

Сети FC-AE-ASM-RT предоставляют ограниченные возможности реконфигурации во время функционирования КБО: в каждый коммутатор может быть заранее загружено несколько таблиц коммутации, переключение между ними поддерживается с кратковременным (несколько десятков миллисекунд) нарушением передачи данных через сеть.

Виртуальный канал $vl$ в сетях AFDX характеризуется следующими атрибутами \cite{2, 6}:

\begin{itemize}
\item $LM_{vl}$ -- максимальный размер кадра, передаваемого по данному виртуальному каналу; 
\item $BAG_{vl}$ -- минимальный промежуток времени между выдачей последовательных кадров при нулевом джиттере порождения; согласно стандарту, данное значение лежит в промежутке от 1 до 128 мс и является степенью двойки;
\item $JM_{vl}$ -- максимальный джиттер порождения кадров на узле-отправителе; 
\item $S_{vl}$ -- узел-отправитель кадров виртуального канала;
\item $D_{vl} = \{d_{vl}\}$ -- множество узлов-получателей кадров виртуального канала ($S_{vl}~\notin~D_{vl}$);
\item $Tree_{vl}$ -- маршрут передачи кадров в сети; маршрут представляет собой дерево, корнем которого является $S_{vl}$, а листьями все элементы множества $D_{vl}$;
\item $MSG_{vl} = \{msg\}$ -- множество сообщений, передаваемых по виртуальному каналу; сообщения порождаются узлом $S_{vl}$ и принимаются узлами из $D_{vl}$.
\end{itemize}

На набор виртуальных каналов в сети AFDX накладываются следующие ограничения:
\begin{itemize}
\item суммарная пропускная способность, зарезервированная для всех виртуальных каналов, проходящих через физическую линию $e$ не должна превышать пропускной способности этой линии:
\begin{equation}\label{eq1}
\sum_{vl \in e}\frac{LM_{vl}}{BAG_{vl}} \leqslant R_{e}
\end{equation}
где $R_{e}$ пропускная способность физической линии $e$.
\item требуемая для передачи сообщений через виртуальный канал частота выдачи кадров не превосходит максимальной частоты выдачи кадров в этот канал:
\begin{equation}\label{eq2}
\forall vl \in VL: 
\sum_{msg \in MSG_{vl}}(\lceil\frac{size_{msg}}{LM_{vl} - c}\rceil~/~T_{msg}) \leqslant \frac{1}{BAG_{vl}}
\end{equation}
Данное ограничение вытекает из того, что все кадры одного экземпляра сообщения $msg$ должны быть выданы в физическую линию до начала выдачи следующего экземпляра сообщения $msg$, то есть за время, не превышающее период $T_{msg}$. Учитывая, что сообщение $msg$ делится на количество кадров $\lceil size_{msg}~/~(LM_{vl} - c) \rceil$, где $c$ --- размер служебных заголовков кадра, получаем ограничение (\ref{eq2}).
\item Максимальный джиттер выдачи кадра на оконечной системе-отправителе не превосходит заданного ограничения (0.5 мс для стандарта AFDX):
\begin{equation}\label{eq3}
\forall vl \in VL: 
JM_{vl} \leqslant 0.5
\end{equation}
\item Максимальная длительность передачи каждого сообщения и максимальный джиттер не превосходят заданных ограничений (определяемых логикой функционирования КБО, а не стандартом сети):
\begin{equation}\label{eq4}
\forall msg \in MSG: Dur(msg) \leqslant \tau_{msg};
Jit(msg) \leqslant J^{*}_{msg}
\end{equation}
где $Dur(msg)$ и $Jit(msg)$ --- длительность передачи и максимальный джиттер сообщения соответственно.
\end{itemize}

К сетям FC-AE-ASM-RT применимы схожие ограничения с тем уточнением, что в этих сетях они применимы на уровне сообщений, а не отдельных кадров.

Существует несколько подходов к проектированию виртуальных каналов для сетей AFDX \cite{6, 7}. Эти подходы принимают в качестве входных данных множество сообщений и строят набор виртуальных каналов, удовлетворяющий ограничениям (\ref{eq1})~---~(\ref{eq4}) и гарантирующий передачу сообщений с учетом ограничений реального времени 1~---~3 из раздела 1. При этом для оценки длительностей и джиттеров передачи сообщений через сеть используются такие математические аппараты, как Network Calculus \cite{8} и Trajectory Approach \cite{9}. Эти подходы и аппараты допускают адаптацию и для сетей FC-AE-ASM-RT.

\section{Ограничения на формирование и смену режимов КБО, связанные с использованием сетей AFDX и FC-AE-ASM-RT}

Примером смены режима функционирования КБО может служить переключение КБО летательного аппарата из режима предполетной подготовки в режим взлета. Штатная реакция КБО на одиночный отказ компонента оборудования (вычислительного модуля, коммутатора, линии связи) также представляет собой переход в один из заранее определенных отказных режимов, в котором не задействуется отказавший компонент, а нагрузка с него перераспределена на оставшиеся в строю компоненты.

При определенных обстоятельствах может потребоваться динамическое (в ходе работы КБО) формирование режима, например:

\begin{itemize}
\item при появлении нового задания для управляемого аппарата, в связи с чем в КБО загружаются новые функциональные задачи, при условии что прерывание функционирования КБО для перенастройки недопустимо;
\item при множественных отказах оборудования КБО.
\end{itemize}

Оба случая особенно актуальны для автономных аппаратов с большой длительностью непрерывного функционирования, таких как космические аппараты и беспилотные летательные аппараты.

Использование сетей AFDX и FC-AE-ASM-RT накладывает следующие ограничения на формирование и изменение режимов функционирования КБО:

\begin{enumerate}
\item Невозможно динамическое формирование режимов функционирования КБО. Доступны только статические режимы, в которых набор прикладных задач и сообщений (включая распределение задач по модулям) определен на стадии проектирования или модернизации.
\item Невозможна гибкая реконфигурация КБО в случае множественных отказов оборудования.
\item Бесшовное переключение между статическими режимами КБО возможно только в случае одновременного (в одной таблице виртуальных каналов на каждом коммутаторе) резервирования пропускной способности под виртуальные каналы всех режимов. Бесшовным будем называть такое переключение режимов, при котором не прерывается передача сообщений, которые должны передаваться как в прежнем, так и в новом режиме.
\end{enumerate}

Поясним, в связи с чем возникают перечисленные ограничения.

Смена режима функционирования КБО приводит к смене набора исполняемых прикладных задач и передаваемых сообщений; изменяется также набор виртуальных каналов, используемых для передачи этих сообщений. Для сетей AFDX, которые не поддерживают изменение таблиц маршрутизации коммутаторов в ходе работы системы, необходимо зарезервировать пропускную способность для всех режимов работы так, как если бы эти режимы функционировали одновременно. Это сильно ограничивает суммарную пропускную способность виртуальных каналов для всех поддерживаемых режимов и приводит к неэффективному использованию пропускной способности физической сети. Коммутаторы сетей FC-AE-ASM-RT поддерживают переключение в ходе работы системы между несколькими заранее заданными таблицами маршрутизации, которые могут соответствовать нескольким различным режимам функционирования. При таком переключении, выполняемом в процессе смены режима функционирования КБО, передача сообщений между задачами, относящимися как к новому, так и к старому режиму, временно прерывается.

Для поддержки динамического формирования режимов функционирования КБО, основанного на сетях AFDX или FC-AE-ASM-RT, необходимо заранее заложить в таблицы маршрутизации всю информацию по виртуальным каналам, используемым во всех потенциально доступных режимах функционирования.

Если режим КБО динамически формируется в связи с появлением новых прикладных задач и потоков данных, невозможно заранее заложить информацию о виртуальных каналах для этих потоков данных в таблицы коммутаторов, в связи с тем, что эта информация недоступна на момент начала функционирования КБО. Следовательно, в таком случае невозможно динамическое формирование режимов функционирования КБО на основе сетей AFDX или FC-AE-ASM-RT.

При отказе вычислительного модуля интегрированного модульного КБО, существует возможность перераспределить его задачи между оставшимися модулями (миграция задач). В этом случае изменяются маршруты виртуальных каналов, соединяющих данные задачи. В сетях AFDX поддержка миграции задач приводит к исключительно неэффективному использованию пропускной способности, поскольку необходимая для взаимодействия двух задач пропускная способность должна быть зарезервирована многократно --- по одному разу на каждое возможное распределение задач между модулями. Для сетей FC-AE-ASM-RT существует возможность рассчитать и заложить в коммутаторы таблицы маршрутизации для всех одиночных отказов; в то же время попытка учесть варианты множественных отказов повлечет за собой резкий рост числа вариантов миграции задач, что приводит к невозможности заложить все соответствующие наборы виртуальных каналов в таблицы маршрутизации коммутаторов. Необходимость парирования отказов сетевых устройств (коммутаторов, линий связи) только усугубляет описанную ситуацию. Тем самым, практически (при числе компонентов КБО порядка 10 и более) невозможно динамическое формирование режимов для парирования множественных отказов в КБО на основе сетей AFDX или FC-AE-ASM-RT.

Даже для поддержки только статических режимов функционирования, бесшовная смена режимов КБО требует одновременного резервирования пропускной способности для виртуальных каналов всех режимов, требующих бесшовного переключения. Для КБО на основе сетей AFDX это единственный способ поддержки переключения режимов; сети FC-AE-ASM-RT поддерживают также переключение между заранее заданными таблицами маршрутизации, что приводит к временному прерыванию обменов между модулями КБО и не может считаться бесшовной сменой режима функционирования.

\section{Передача данных в реальном времени по виртуальным каналам в сети ПКС}
Для устранения описанных в разделе 3 ограничений, возникающих при использовании в КБО сетей AFDX и FC-AE-ASM-RT, целесообразно использовать ПКС вместо этих сетей. Данная целесообразность обусловлена тем, что описанные ограничения вызваны ограниченными (в случае FC-AE-ASM-RT) или полностью отсутствующими (в случае AFDX) возможностями изменения конфигурации сети, а именно набора виртуальных каналов и их параметров, включая маршруты, в ходе функционирования системы. С точки зрения реконфигурации сети ключевой особенностью ПКС является поддержка динамической, осуществляемой в ходе функционирования, перенастройки коммутаторов и наличия контроллера сети, приложения которого могут отвечать за эту перенастройку.

Авторами настоящей работы предлагается подход к использованию ПКС в качестве бортовых сетей, основанный на реализации в ПКС схемы передачи данных в реальном времени, обладающей следующими основными чертами:

\begin{itemize}
\item для контроля трафика и разделения пропускной способности между потоками данных используется механизм виртуальных каналов;
\item контроль трафика виртуальных каналов организован по аналогии с сетями AFDX и FC-AE-ASM-RT;
\item сохраняется применимость существующих подходов к оценке задержек и джиттеров передачи данных, разработанных для сетей AFDX;
\item контроллер сети функционирует в проактивном (пассивном) режиме;
\item поддерживается динамическое изменение набора виртуальных каналов (включая изменение их параметров и маршрутов) без прекращения передачи данных по не изменяемым виртуальным каналам.
\end{itemize}

Использование существующей и практически отработанной в существующих бортовых сетях AFDX и FC-AE-ASM-RT схемы управления трафиком, с одной стороны, ориентировано на упрощение возможной модернизации существующих КБО и создания новых КБО на основе существующих, а с другой стороны, позволяет использовать известные подходы к обоснованию соблюдения требований реального времени к передаче данных через сеть.

Проактивный режим функционирования контроллера гарантирует отсутствие избыточного трафика между коммутаторами и контроллером, за исключением трафика, необходимого для мониторинга и перенастройки сети. Это существенно как с точки зрения минимизации нагрузки на сеть, так и для обеспечения прогнозируемости времен передачи данных через сеть, поскольку не требуется модифицировать существующие методы оценки задержек и джиттера для учета воздействия служебного трафика. Выбор между активным и проактивным режимами работы контроллера подробнее рассмотрен в \cite{10}.

Предложенная схема использует стек протоколов TCP/IP за исключением маршрутизации на основе IP-адресов. Передаваемое сообщение разделяется на множество UDP-пакетов, каждый из которых соответствует одному кадру канального уровня (т.е. Ethernet). Эти пакеты посылаются узлом-отправителем в соответствии со схемой, используемой в сетях AFDX, с интервалами, равными параметру виртуального канала $BAG_{vl}$. Номер виртуального канала указывается в поле vlan заголовка пакета. Маршрутизация пакета коммутаторами производится на основе номера виртуального канала, как и в сетях AFDX и FC-AE-ASM-RT. Для осуществления маршрутизации в таблицы коммутаторов заносятся специальные правила, которые в зависимости от значения поля с номером виртуального канала отправляют пакет на соответствующий выходной порт коммутатора. Пакеты, размер которых превышает заданный лимит для виртуального канала, так же как и пакеты, пришедшие на порт, не соответствующий указанному в их заголовках виртуальному каналу, сбрасываются коммутатором.

Контроль трафика производится при помощи измерителей (meter) --- технологии, введенной в протоколе OpenFlow 1.3 \cite{11}. Измеритель ассоциируется с потоком; в рассматриваемом случае поток определяется как последовательность принятых пакетов с определенным номером виртуального канала, т.е. пакетов заданного виртуального канала. Для каждого измерителя на коммутаторе определен свой набор интервалов скоростей потока. В зависимости от принадлежности текущей измеренной скорости потока к одному из интервалов, к полученному пакету применяется заданное для этого интервала действие, например, дальнейшая передача или сброс.

Способ измерения скорости потока не определяется протоколом OpenFlow 1.3 и зависит от реализации механизма измерителей на конкретном коммутаторе. В рамках предлагаемой в данной работе схемы передачи данных, от коммутатора требуется поддержка измерения скорости потока на основе алгоритма текущего ведра, аналогичного используемому в AFDX. Это позволяет контролировать не только непревышение скоростью потока пропускной способности виртуального канала, но и то, что джиттер передачи сообщений не превышает максимально допустимого. Примером коммутатора, поддерживающего требуемую схему расчета скорости потока, является программный коммутатор \textit{Ofsoftswitch13}.

Измерители настраиваются на коммутаторах при помощи протокола OpenFlow следующим образом. Для каждого коммутатора, для каждого виртуального канала, проходящего через этот коммутатор:
\begin{itemize}
\item задается измеритель виртуального канала при помощи сообщения \textit{FlowMod};
\item измерителю при помощи сообщения \textit{MeterMod} задается максимальное значение кредита и величина $LM_{vl}~/~BAG_{vl}$ (в качестве полей $burst\_size$ и $rate$, соответственно).
\end{itemize}

В соответствии с предлагаемым подходом, виртуальный канал в ПКС имеет тот же набор параметров, что и виртуальный канал сети AFDX (см. раздел 2). Поскольку схема выдачи данных абонентом в физическую линию и схема контроля трафика на коммутаторе заимствованы из AFDX, для предлагаемого подхода применимы разработанные для сетей AFDX схемы оценки задержек и джиттера передачи данных через сеть \cite{8,9}, а также методы построения систем виртуальных каналов \cite{6}.

\section{Апробация предлагаемого подхода}

Авторами было проведено экспериментальное исследование предлагаемой схемы передачи данных в реальном времени в ПКС. Эксперименты были проведены в виртуальной среде, построенной на основе эмулятора сети mininet, ПКС-контроллера RUNOS и программного коммутатора Ofsoftswitch13.

В среде контроллера RUNOS было реализовано служебное приложение, поддерживающие настройку коммутаторов на заданный набор виртуальных каналов, а также снятие и добавление отдельных виртуальных каналов. Собственно сценарии экспериментов реализованы в виде приложений контроллера, обращающихся к служебному приложению для построения и модификации конкретных систем виртуальных каналов.

Экспериментальное исследование преследовало следующие цели:
\begin{itemize}
\item оценить задержки и джиттер передачи сообщений через сеть, подтвердить их соответствие расчетам по методикам, принятым для сетей AFDX;
\item подтвердить, что предложенная схема позволяет осуществлять передачу различных потоков данных с гарантированной пропускной способностью для каждого из потоков;
\item подтвердить, что попытки узла передавать данные по виртуальному каналу со скоростью, превышающей максимально допустимую пропускную способность, блокируются коммутатором;
\item провести динамическую модификацию набора виртуальных каналов в соответствии с различными сценариями, типичными для КБО, а также подтвердить, что передача данных по виртуальным каналам, не затронутым модификацией, не прерывалась.
\end{itemize}

Количество виртуальных каналов и их параметры были взяты из работы по проектированию сетей AFDX \cite{6}. Количество виртуальных каналов, в зависимости от эксперимента, достигало нескольких десятков.

В качестве топологий сети были взяты обе описанные в \cite{6}, а также топологии, типичные для интегрированных модульных КБО, например, топология «множественная звезда» (Рис.~\ref{fig3}) и топология с подключением каждого абонента к двум коммутаторам (Рис.~\ref{fig4}).

\begin{figure}[ht]
	\centering
	\includegraphics[width=0.50\textwidth]{fig3.png}
	\bicaption[russian]{Топология «множественная звезда».}[english]{Multiple star network topology.}
	\label{fig3}
\end{figure}

\begin{figure}[ht]
	\centering
	\includegraphics[width=0.50\textwidth]{fig4.png}
	\bicaption[russian]{Топология с подключением каждого абонента к двум коммутаторам.}[english]{Network topology with every node connected to two switches.}
	\label{fig4}
\end{figure}

Проведенные эксперименты показали, что для рассмотренных потоков данных и топологий сети предложенная схема передачи данных в ПКС гарантирует обеспечение требуемой пропускной способности для каждого потока данных с задержкой и джиттером, удовлетворяющим заданным верхним ограничениям. В экспериментах, где некоторые абоненты формировали трафик, выходящий за ограничения для заданного виртуального канала (слишком большие UDP-пакеты и/или слишком малые интервалы между пакетами), коммутатор осуществлял сброс пакетов этого виртуального канала, тем самым предотвращая превышение ограничений на пропускную способность физической линии.

В экспериментах использовались следующие сценарии динамической модификации систем виртуальных каналов:
\begin{enumerate}
\item “обычная” смена режима КБО: часть виртуальных каналов сохраняет функционирование, остальные каналы удаляются, а вместо них добавляются новые каналы;
\item миграция задач в случае выхода из строя вычислительного модуля: виртуальные каналы, входящие или исходящие для вышедшего из строя узла, перекладываются в соответствии со своими новыми маршрутами;
\item реконфигурация сети в случае выхода из строя физической линии передачи данных или коммутатора: виртуальные каналы, проходившие через сбойный элемент сети, меняют свои маршруты на обходные.
\end{enumerate}

Во всех перечисленных сценариях новые маршруты виртуальных каналов были заданы в составе исходных данных. Поддержка построения новых маршрутов виртуальных каналов в ходе функционирования КБО является предметом дальнейших исследований.

Эксперименты со сценарием 1 показали, что при удалении/добавлении виртуальных каналов передача данных через не изменяющиеся виртуальные каналы не нарушается. Также не нарушалась передача данных через не изменяющиеся виртуальные каналы в экспериментах со сценариями 2 и 3.

Основное отличие сценариев 2 и 3 от сценария 1 в том, что выдача данных в изменяемые виртуальные каналы не прекращалась. Настройка коммутаторов на новый маршрут виртуального канала начиналась с первого из коммутаторов (считая по направлению передачи данных), после которого канал идет по новому маршруту. Эксперименты показали, что при настройке коммутаторов на новый маршрут виртуального канала терялись несколько пакетов; конкретное число зависит от частоты выдачи пакетов, т.е. от значения параметра $BAG_{vl}$. Нарушения передачи данных через другие виртуальные каналы при этом не происходило.

Проведенные эксперименты показали, что предлагаемый подход к построению бортовых сетей передачи данных в реальном времени позволяет сохранить предсказуемость временных характеристик, характерную для сетей AFDX и FC-AE-ASM-RT, при этом позволяет устранить накладываемые этими сетями ограничения на формирование и смену режимов КБО. 
 
\section{Необходимый объем адаптации ПКС-технологий для применения в КБО}

КБО является критически важным элементом управляемых систем, таких как летательные или космические аппараты. К аппаратно-программным средствам в составе КБО, в т.ч. средствам передачи данных, предъявляются жесткие требования по надежности функционирования в сложных условиях эксплуатации (повышенная температура, вибрация, воздействие радиации). В связи с этим при реализации контроллеров и коммутаторов ПКС для КБО необходимо использовать технологии, не уступающие по уровню устойчивости к жестким условиями эксплуатации остальным компонентам КБО, в том числе вычислительным модулям. Следует отметить, что данное условие может быть реализовано автоматически за счет использования штатных вычислительных мощностей (вычислительных модулей) в составе интегрированных модульных КБО для реализации программных коммутаторов и контроллеров ПКС. Однако при переходе к использованию аппаратных коммутаторов проблема «бортового» исполнения оборудования встанет вновь.

Для использования ПКС-технологий в КБО таких аппаратов, как автомобили и пассажирские самолеты, аппаратный и программный компоненты ПКС, а также процессы их разработки, должны быть сертифицированы в соответствии с рядом промышленных стандартов, таких как DO-178C \cite{11} для авиационных комплексов.

\section{Заключение}
В существующих интегрированных модульных комплексах бортового оборудования (КБО) используются коммутируемые сети AFDX и FC-AE-ASM-RT, реализующие основанный на виртуальных каналах подход к передаче данных в реальном времени. Основным недостатком этих сетей являются ограниченные или отсутствующие возможности динамической реконфигурации виртуальных каналов, приводящие к невозможности динамического формирования режимов функционирования КБО, в частности при множественных отказах оборудования.

Для снятия выявленных ограничений авторами предложен подход к использованию ПКС для построения бортовых сетей реального времени. Предложенный подход основан на реализации в сети ПКС, поддерживающей протокол OpenFlow1.3, механизма виртуальных каналов, аналогичного используемому в сетях AFDX и FC-AE-ASM-RT. Подход реализован в виде функционального прототипа и экспериментально апробирован в виртуальной сетевой среде, основанной на программных ПКС-коммутаторах Ofsoftswitch13 и сетевом контроллере RUNOS. Эксперименты показали, что предложенная схема передачи данных позволяет передавать сообщения с соблюдением заданных ограничений на задержку и джиттер, а также не допускает превышения ограничения на пропускную способность виртуального канала. Эксперименты также подтвердили, что динамическая реконфигурация виртуальных каналов в ПКС не нарушает передачу данных по не изменяемым виртуальным каналам.

К направлениям дальнейших работ можно отнести:
\begin{itemize}
\item разработку алгоритмов для динамического формирования новых маршрутов виртуальных каналов в процессе реконфигурации КБО, в т.ч. при парировании отказов вычислительных модулей и сетевых устройств;
\item реализацию созданных алгоритмов в рамках приложения для ПКС-контроллера;
\item интеграцию созданного приложения со средствами мониторинга состояния КБО, в т.ч. мониторинга элементов сети.
\end{itemize}

Объединяющей целью перечисленных работ является создание на основе ПКС сетевой технологии, обеспечивающей как передачу данных в реальном времени, так и автоматическое переконфигурирование сети при смене режимов функционирования КБО, в том числе при парировании множественных отказов.

\medskip
\renewcommand{\refname}{Список литературы / References}
{\footnotesize
\begin{thebibliography}{99}%Пример оформления списка литературы с помощью пакета amsbib. Для публикаций на русском языке в скобках приводится вариант на англ. языке, если есть (примеры 10 и 12), или транслитерация(примеры 3, 6, 7 и др.).


\Bibitem{1}
\by T. Gaska, C. Watkins, and Y. Chen
\paper Integrated Modular Avionics --- Past, present, and future
\jour IEEE Aerospace and Electronic Systems Magazine
\yr 2015
\vol 30
\issue 9
\pages 12--23

\Bibitem{2}
\book Aircraft Data Network. Part 7. Avionics Full Duplex Switched Ethernet (AFDX) Network: Aeronautical Radio
\yr 2012

\Bibitem{3}
\book INCITS 373. Information Technology --- Fibre Channel Framing and Signaling Interface (FC-FS): International Committee for Information Technology Standards
\yr 2003

\RBibitem{4}
\by Осипов Ю.С., Першин А.С., Пустовой Ю.В.
\paper Способ передачи информации в реальном времени с использованием локальных сетей ограниченного размера на базе модификации протокола FC-AE-ASM
\jour патент RU2536659, ОАО “НТЦ ГРЭК“
\yr 2013
\transl
[\by Y. Osipov, A. Pershin, Y. Pustovoy
\paper Method for Real-Time Information Transmission Using Small-Scale Local Area Networks Based on FC-AE-ASM Protocol Modification
\jour Patent RU2536659C1, NTC GREK
\yr 2013
\finalinfo (in Russian).\nofrills]

\Bibitem{5}
\by A. Shalimov, S. Nizovtsev, D. Morkovnik, and R. Smeliansky.
\paper The RUNOS OpenFlow Controller
\proc 4th European Workshop on Software Defined Networks
\jour IEEE
\yr 2015
\pages 103--104

\RBibitem{6}
\by Вдовин П.М., Костенко В. А.
\paper Организация передачи сообщений в сетях AFDX
\jour Программирование
\vol 43
\issue 1
\yr 2017
\pages 5--20
\transl
[\by P. Vdovin and V. Kostenko
\paper Organizing Message Transmission in AFDX Networks
\jour Programming and Computer Software
\vol 43
\issue 1
\yr 2017
\pages 5--20
\finalinfo (in Russian).\nofrills]

\Bibitem{7}
\by A. Al Sheikh, O. Brun, and P.-E. Hladik
\paper Optimal Design of Virtual Links in AFDX Networks
\jour Real-Time Systems
\yr 2013
\vol 49
\issue 2
\pages 308--336

\Bibitem{8}
\by M. Boyer and C. Fraboul
\paper Tightening End to End Delay Upper Bound for AFDX Network Calculus with Rate Latency FIFO Servers Using Network Calculus
\proc IEEE International Workshop on Factory Communication Systems
\jour IEEE
\yr 2008
\pages 11--20

\Bibitem{9}
\by H. Bauer, J. L. Scharbarg, and C. Fraboul
\paper Applying and Optimizing Trajectory Approach for Performance Evaluation of AFDX Avionics Network
\proc IEEE Conference on Emerging Technologies and Factory Automation
\jour IEEE
\yr 2009
\pages 1--8

\Bibitem{10}
\by V. Balashov, V. Kostenko, P. Vdovin, R. Smeliansky, and A. Shalimov
\paper An Analysis of Approaches to Onboard Networks Design
\proc 2014 International Science and Technology Conference on Modern Networking Technologies
\jour IEEE
\yr 2014
\pages 20--14

\Bibitem{11}
\book DO-178C Software Considerations in Airborne Systems and Equipment Certification: RTCA
\yr 2011
\bookinfo Committee SC-205

\end{thebibliography}}
\vskip 8pt
   \smallskip\hrule width 6cm
\medskip
\end{document}



